---
title: 数据类型
date: 2021-03-20 15:49:48
permalink: /pages/cbd711/
categories:
  - 数据库
  - NoSQL
  - Redis
tags:
  - 
---

深入参考：[硬核Redis总结，看这篇就够了！ (qq.com)](https://mp.weixin.qq.com/s/lsOYc2pxXo1vYs8_E0R3uQ)

## 8大基本数据类型

![图片](https://img.xiaoyou66.com/2021/03/20/27fca3ce4c8e4.png)

### String

> 适用于简单key-value存储、setnx key value实现分布式锁、计数器(原子性)、分布式全局唯一ID。

底层使用 **char[]** 实现，Redis 使用`SDS`(simple dynamic string)封装char[]（这是是Redis存储的`最小单元`），最大可以存储512M信息。数据结构如下：

```
struct sdshdr{
  unsigned int len; // 标记char[]的长度
  unsigned int free; //标记char[]中未使用的元素个数
  char buf[]; // 存放元素的坑
}
```

Redis对SDS再次封装生成了`RedisObject`，核心有两个作用：

1. 说明是5种类型哪一种。
2. 里面有指针用来指向 SDS。

当你执行`set name sowhat`的时候，其实Redis会创建两个RedisObject对象，键的RedisObject 和 值的RedisOjbect 其中它们type = REDIS_STRING，而SDS分别存储的就是 name 跟 sowhat 字符串。

并且Redis底层对SDS有如下优化：

> 1. SDS修改后大小 > 1M时 系统会多分配空间来进行`空间预分配`。
> 2. SDS是`惰性释放空间`的，你free了空间，可是系统把数据记录下来下次想用时候可直接使用。不用新申请空间。

### List

使用双向链表实现，该链表最大长度为`2^32-1` 。

![图片](https://img.xiaoyou66.com/2021/03/20/c59e45ec4e742.png)

可以组合为先进后出的栈、先进先出的队列、有限集合、消息列队。

一般可以用来做简单的消息队列，并且当数据量小的时候可能用到独有的压缩列表来提升性能。

### Hash

> Redis中只有一个K，一个V。其中 K 绝对是字符串对象，而 V 可以是String、List、Hash、Set、ZSet任意一种。
>
> 底层主要是采用字典dict的结构，整体呈现层层封装。（dict包含dictht包含dictEntry）

1. dictEntry 是真正的数据节点，包括key、value 和 next 节点。
2. dictht包含下面几个内容
   1. **dictEntrytable:**数据 dictEntry 类型的数组，每个数组的item可能都指向一个链表。
   2. **size**:数组长度 size
   3. **sizemask** :等于 size - 1
   4. **used**:当前 dictEntry 数组中包含总共多少节点
3. dict包括下面几个内容
   1. dictType 类型，包括一些自定义函数，这些函数使得key和value能够存储
   2. rehashidx 其实是一个标志量，如果为`-1`说明当前没有扩容，如果`不为 -1` 则记录扩容位置。
   3. dictht数组，两个Hash表。
   4. iterators 记录了当前字典正在进行中的迭代器

**整体结构如下**

![图片](https://img.xiaoyou66.com/2021/03/20/b8e0810f27add.png)

### Set

类似于Java中HashSet是[HashMap](https://mp.weixin.qq.com/s?__biz=MzI4NjI1OTI4Nw==&mid=2247485513&idx=1&sn=340e879f3197ae9e3d8789a1ad55a76e&scene=21#wechat_redirect)的简化版

### ZSet

> 用于积分排行榜、时间排序新闻、延时队列。

有序的set，Zset用的就是可以跟二叉树媲美的`跳跃表`来实现有序。跳表就是多层**链表**的结合体，跳表分为许多层(level)，每一层都可以看作是数据的**索引**，**这些索引的意义就是加快跳表查找数据速度**。

跳表每一层的数据都是有序的，上一层数据是下一层数据的子集，并且第一层(level 1)包含了全部的数据；层次越高，跳跃性越大，包含的数据越少。

redis跳跃表可以参考：[跳跃表 — Redis 设计与实现 (redisbook.readthedocs.io)](https://redisbook.readthedocs.io/en/latest/internal-datastruct/skiplist.html)

### Redis Geo



他的核心思想就是将地球近似为球体来看待，然后 GEO利用 GeoHash 将二维的经纬度转换成字符串，来实现位置的划分跟指定距离的查询。

### HyperLogLog

### bitmap

## 布隆过滤器

## Hash如何扩容

